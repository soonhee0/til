##アプリを軽量にしてデプロイする
dockerコンテナサイズを小さくする
next.jsのバージョンを13.5以降にするとメモリを29%削減できる
EC2をm２マイクロに乗せられる範囲にする

・インスタンスはバージニア北部が安い

##AWSのコスト管理
コストと使用状況
AWSの予算設定　「AWSバジェット」
請求とコスト管理ホームをチェックしておく

## コスト削減のための留意点
NAT GATEwayが高いのでできるだけ置かないように
NAT GAtewayはプライベートのサブネットに対して必要となるので、サブネットはパブリックのみにしておくのがよい
igw(インターネットゲートウェイ)は必ず必要
ALBを使うと アベイラビリティゾーンが２つ必要　サブネットが2個
構成が大きくなるので、小さくなるなら、ALBなしでEC2で作成するのがおすすめ
ALBの元々の役割は負荷分散
個人的なシンプルなアプリを作成をするのであれば、ALBは使わなくて良い

本来はALBを噛ませてEC2を複数使って負荷を分散させるのが良いが、そうするとお金がかかる

##アプリのデプロイ
案１　
vercel と　amazon EC2とRDSを利用

案２
EC2にnext.jsとnodejsとpython両方入れる＋RDSを利用
dockerは使わない（dockerは重い。）

RDSもEC2も無料枠あり

##ドメインをとるとお金がかかる。
##IPアドレスは口外しない。ドメインとしてはパブリックIPv4 DNSに記載のものを共有すればよい

##EC2のインスタンスにgithubであげる
EC2の中に入ってgithubをインストールする
git コマンドをEC2上で使えるようにするとローカルからではなくてgitから落としてこれる
パブリックリポジトリだと簡単だが、プライベートリポジトリだとkeyを設定しないといけない

##やったこと
githubとEC2との接続　git clone

##failの転送
案１　github 頻繁にデプロイ後もコードを更新する場合
案２　ローカルから一つずつファイルをあげる  
　　　　選択したファイルを一つずつアップロードできる
    　　githubのリポジトリを乗っ取られるリスクがなくなる
      failgilaを入れると便利

## EC2インスタンス作成、EC2をgithub接続あとの手順
> 環境構築　EC2上にpythonならpython、next.jsならNode.jsを入れる
> サーバーサイドのAPIを環境変数からとっている場合、
キーにパブリックIPv4 DWSを設定する　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　>
> 公開鍵を接続先に保存する
公開鍵はSSH接続する際に接続先のサーバーが認証のために利用する。
具体的には公開鍵を接続先のサーバーの~/.ssh/authorized_keysファイルに追加することで、そのサーバーへのSSH接続が秘密鍵に対応する公開鍵を持つクライアントから許可されるようになる　　





